{% extends "base.html" %}
{% load form_tags %}
{# checkins/templates/checkins/_anchor_builder.html #}
{# builds habit anchor, prompt type and celebration inputs #}
{# includes a small JavaScript preview for “After I … I will …” habit recipe #}

<!-- anchor text input: guides users to create an action-based habit trigger -->
<div class="form-group">
  <label for="id_anchor_text" class="form-label">Anchor (optional)</label>
  {{ form.anchor_text|add_class:"form-input" }}
  <small class="form-help">Use the recipe: “After I [existing action], I will [tiny behavior].”</small>
</div>

<!-- prompt type dropdown: lets users select between action, context, or person anchors -->
<div class="form-group">
  <label for="id_prompt_type" class="form-label">Prompt Type</label>
  {{ form.prompt_type|add_class:"form-select" }}
  <small class="form-help">Action-anchored prompts are usually most reliable.</small>
</div>

<!-- celebration input: short positive reinforcement phrase (Tiny Habits principle) -->
<div class="form-group">
  <label for="id_celebration_note" class="form-label">Celebration</label>
  {{ form.celebration_note|add_class:"form-input" }}
  <small class="form-help">Feeling good locks habits in — keep it short and positive.</small>
</div>

<hr class="card-divider" />

<!-- live preview area: shows “After I … I will …” as the user types -->
<p><strong>Preview</strong></p>
<p id="anchor-preview" aria-live="polite" class="text-muted">After I … I will …</p>

<!-- small inline script for real-time preview updates -->
<script>
  // self-contained script (no dependencies)
  // updates preview text as the user edits the anchor_text field
  (function () {
    const anchorInput = document.getElementById("id_anchor_text");
    const preview = document.getElementById("anchor-preview");
    if (!anchorInput || !preview) return;  // exit if elements not found

    // update preview text dynamically
    function updatePreview() {
      const v = anchorInput.value.trim();
      preview.textContent = v.length ? v : "After I … I will …";
    }

    // attach input listener for live updates
    anchorInput.addEventListener("input", updatePreview);

    // initialize preview on page load
    updatePreview();
  })();
</script>