{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- page heading -->
<h1 class="page-title">Dashboard</h1>
<!-- personalized greeting using the logged-in user's username -->
<p class="page-subtitle">Welcome, {{ request.user.username }}!</p>

<!-- (1) Current streak section -->
<!-- Displays how many consecutive days the user has checked in -->
<section aria-labelledby="streak" class="card">
  <h2 id="streak" class="card-title">Current Streak</h2>
  <p class="streak-summary">{{ streak.days }} days</p>
</section>

<!-- (2) Mood and status trend over the past 7 days -->
<!-- Uses Django context variable 'trend', showing daily mood/status values -->
<section aria-labelledby="trend" class="card">
  <h2 id="trend" class="card-title">7-Day Trend (Mood/Status)</h2>
  <ul>
    {% for point in trend %}
    <!-- Each list item displays a date with associated mood and status -->
    <li>{{ point.date }} — mood={{ point.mood|default:"–" }}, status={{ point.status }}</li>
    {% endfor %}
  </ul>
  <!-- Reference: (Ref-C) background calculation of a 3-day moving average for mood tracking -->
  <p class="text-muted"><small>(Ref-C) 3-Day moving average for mood calculated in background.</small></p>
</section>

<!-- Small Analytics Extension (Ref-C)
       This section adds a lightweight analytics summary to the dashboard.
       It uses data from the last 7 days (provided by the Django view) to show
       how many "risk days" occurred — defined as days with low mood (≤2)
       or a warning/block status. The approach is inspired by Ref-C (ISL),
       applying a simple and interpretable statistical summary. -->
<section aria-labelledby="analytics" class="card">
  <!-- Accessible heading label for screen readers -->
  <h2 id="analytics" class="card-title">Analytics</h2>

  <!-- Display the total number of "risk days" calculated in the backend -->
  <p>
    Risk days in the last 7&nbsp;days: <strong>{{ risk_count }}</strong>
  </p>

  <!-- Loop through the 7-day trend data and list each day that qualifies as "risky"
         (either status = warn/block or mood ≤ 2). -->
  <ul class="risk-day-list">
    {% for point in trend %}
    {% if point.status == "warn" or point.status == "block" or point.mood|default:3 <= 2 %} <!-- Show the date, status,
      and mood for each risk day -->
      <li class="risk-day-item">{{ point.date }} → {{ point.status }} (mood={{ point.mood|default:"–" }})</li>
      {% endif %}
      {% endfor %}
  </ul>

  <!-- Small note referencing Ref-C (ISL) to document the statistical rationale -->
  <p class="text-muted">
    <small>
      (Ref-C) Simple statistical evaluation – counts days with low mood or warning status.
    </small>
  </p>
</section>

<!-- (3) Tiny Habits suggestion section -->
<!-- Displays a personalized behavioral suggestion derived from Tiny Habits model -->
<section aria-labelledby="tiny" class="card">
  <h2 id="tiny" class="card-title">Tiny Habit Suggestion</h2>
  <p>{{ tiny_prompt }}</p>
  <!-- Reference: (Ref-A) Behavior model B=MAP (Motivation, Ability, Prompt) from Fogg (2020) [oai_citation:0‡Tiny Habits PDF.pdf](file-service://file-NuAXva6xhrtkyTnQcJKoan) -->
  <p class="text-muted"><small>(Ref-A) B=MAP, Starter-Step, Prompt-Design.</small></p>
</section>

<!-- (4) HRV tip section -->
<!-- Displays short context-based heart rate variability insights for recovery tracking -->
<section aria-labelledby="hrv" class="card">
  <h2 id="hrv" class="card-title">HRV Note</h2>
  <p>{{ hrv_tip }}</p>
  <!-- Reference: (Ref-B) RMSSD interpretation from *Frontiers in Sports and Active Living* (Storniolo et al., 2025) [oai_citation:1‡fspor-1-1574087.pdf](file-service://file-3EVASBZjiZtSikC4S7tY8U) -->
  <p class="text-muted"><small>(Ref-B) Short Info about RMSSD Interpretation.</small></p>
</section>

<!-- HRV-based readiness card -->
<section aria-labelledby="readiness" class="card readiness-status">
  <!-- heading to describe the HRV readiness classification -->
  <h2 id="readiness" class="card-title">Today’s Readiness</h2>

  <!-- show the coarse readiness label, e.g., "High readiness" / "Moderate readiness" / "Low readiness" -->
  <p class="readiness-label">
    Status:
    <strong>{{ readiness.label }}</strong>
  </p>

  <!-- show the explanatory description from the backend helper -->
  <p class="readiness-description">
    {{ readiness.description }}
  </p>

  <!-- Tiny Habits–aligned microcopy (Ref-A):
       encourage small wins and appropriate scaling based on readiness -->
  <p class="text-muted">
    Use this as a guide to size your next tiny habit:
    when readiness is lower, shrink the habit and celebrate completing it.
  </p>
</section>

<!-- (5) Adherence Forecast Section -->
<!-- Displays model-predicted likelihood of next habit completion -->
<section aria-labelledby="forecast" class="card">
  <h2 id="forecast" class="card-title">Today’s Adherence Forecast</h2>

  <!-- Display computed completion probability (from Week 7 logistic model) -->
  <p class="forecast-value">{{ completion_prob }}% likelihood you’ll complete your next habit.</p>

  <!-- Explanatory note connecting behavioral and physiological data -->
  <p class="forecast-caption text-muted">
    Based on your last 7 days of check-ins (behavioral consistency, reflecting Tiny Habits’
    idea of successive wins) and your most recent HRV reading (physiological readiness).
  </p>
</section>

{% endblock %}